# 需求分解与任务规划

用户将在后面描述他们的需求，你需要将需求拆解为若干个可管理的小任务，并更新到 ROADMAP.md 中。

## 执行流程

### 1. 深度理解需求
- **不要急于编写代码** - 先与用户充分交流
- 主动提问澄清需求的具体细节和边界条件
- 理解业务背景和技术约束
- 确认成功标准和验收条件

### 2. 全面调研分析
- **代码库调研**: 阅读现有代码，理解项目架构和模式
- **技术调研**: 搜索相关文档、最佳实践和解决方案
- **依赖分析**: 检查现有技术栈，避免引入不必要的新依赖

### 3. 方案设计与对比

#### 3.1 识别关键问题
询问用户需要考虑的问题，包括但不限于：
- 性能要求和可扩展性
- 安全性和数据保护
- 向后兼容性
- 部署和运维考虑
- 测试策略

#### 3.2 方案对比
提供多种符合业界实践的技术方案：
- **方案A**: [简单直接的实现方式]
  - ✅ 优点：开发速度快，风险低
  - ❌ 缺点：可能扩展性有限
  
- **方案B**: [更完整的架构方案]
  - ✅ 优点：架构清晰，易于维护
  - ❌ 缺点：开发复杂度较高
  
- **方案C**: [创新或前沿的解决方案]
  - ✅ 优点：技术先进，性能优异
  - ❌ 缺点：学习成本高，风险较大

#### 3.3 推荐方案
基于项目现状、团队能力和业务需求，推荐最适合的方案，并说明理由。

### 4. 任务分解

将需求分解为具体的、可执行的任务：

#### 4.1 三层分解原则

**Requirement (需求)**:
- 代表一个完整的业务需求或功能模块
- 通常需要 1-2 周完成
- 具有明确的业务价值和用户可见的成果

**Task (任务)**:
- Requirement 的子任务，代表一个技术模块或功能组件
- 工作量控制在 1-3 天内
- 具有独立的验收标准和交付物
- 任务间依赖关系要清晰明确

**Step (步骤)**:
- Task 的具体执行步骤，原子化的工作单元
- 工作量控制在 0.5-1 天内
- 每个步骤都有明确的输入、输出和验证方法
- 步骤应该是连续的，前一步的输出是后一步的输入

#### 4.2 任务分类
- **研究任务**: 技术调研、API 探索、原型验证
- **开发任务**: 功能实现、接口开发、测试编写
- **集成任务**: 模块集成、端到端测试、部署配置
- **文档任务**: 技术文档、用户文档、API 文档

### 5. 更新 ROADMAP (渐进式分解策略)

**核心原则**: 只详细拆解当前要执行的Task，后续Task保持高层次描述，避免过度规划。

将需求按照 **Requirement → Task → Step** 三层结构分解，更新到 `.claude/ROADMAP.md` 中：

```markdown
## Requirement: [需求/功能名称]

### 优先级: [高/中/低]
### 预估总时间: X天
### 依赖: [前置Requirement]

#### 🔄 Task 001: [当前任务标题] (预估: X天) - **[进行中]**
**描述**: [任务详细描述]
**验收标准**: [具体验收条件]

##### Steps: (详细拆解)
- [ ] **Step 001.1**: [具体步骤] (0.5天)
  - 输入: [所需输入]
  - 输出: [预期产出]
  - 验证: [验证方法]

- [ ] **Step 001.2**: [具体步骤] (1天)
  - 输入: [所需输入] 
  - 输出: [预期产出]
  - 验证: [验证方法]

- [ ] **Step 001.3**: [具体步骤] (0.5天)
  - 输入: [所需输入]
  - 输出: [预期产出]
  - 验证: [验证方法]

#### ⏳ Task 002: [下一个任务标题] (预估: X天) - **[待分解]**
**描述**: [高层次描述即可]
**依赖**: Task 001
**备注**: 将在Task 001完成后详细拆解Steps

#### ⏳ Task 003: [后续任务标题] (预估: X天) - **[待分解]**
**描述**: [高层次描述即可]
**依赖**: Task 002

---

## Requirement: [下一个需求/功能名称] - **[待规划]**
**概述**: [简要描述即可，具体Task待Requirement开始时规划]
```

### 渐进式更新流程:
1. **当前Task完成后**: 将其标记为✅完成
2. **开始下一个Task前**: 将下一个Task从"待分解"改为"进行中"，并详细拆解Steps
3. **新需求到来时**: 添加新Requirement，但只做高层次规划

### 6. 创建详细 PRP

为每个复杂任务创建详细的 PRP (Product Requirements Prompt) 文件：
- 保存到 `.claude/tasks/` 目录
- 文件命名：`001-[task-name].md`, `002-[task-name].md` 等
- 使用 `000-sample.md` 作为模板
- 包含完整的上下文、实现细节和验证标准

**示例文件名**:
- `001-user-authentication.md`
- `002-database-schema.md`
- `003-api-endpoints.md`

## 输出格式

### 需求理解确认
```markdown
## 需求理解确认

### 核心需求
[用自己的话重述需求]

### 关键问题
1. [问题1]
2. [问题2]
...

### 假设条件
1. [假设1]
2. [假设2]
...
```

### 方案对比
```markdown
## 技术方案对比

### 方案A: [方案名称]
**实现方式**: [简要描述]
**优点**: 
- [优点1]
- [优点2]

**缺点**: 
- [缺点1]
- [缺点2]

**适用场景**: [场景描述]

[其他方案...]

### 推荐方案
**选择**: 方案X
**理由**: [详细说明选择理由]
```

### 任务分解结果 (渐进式输出)
```markdown
## Requirement 1: [需求/功能名称]

### 🔄 Task 001: [首个任务名称] (预估: X天) - **[立即开始]**
**目标**: [任务目标描述]
**优先级**: 高
**依赖**: 无

#### Steps: (详细拆解 - 可立即执行)
1. **Step 001.1**: [具体步骤] (0.5天)
   - 工作内容: [详细描述要做什么]
   - 输入: [所需的输入/前置条件]
   - 输出: [预期产出/交付物]
   - 验证: [如何验证完成]

2. **Step 001.2**: [具体步骤] (1天)
   - 工作内容: [详细描述]
   - 输入: Step 001.1 的输出
   - 输出: [预期产出]
   - 验证: [验证方法]

3. **Step 001.3**: [具体步骤] (0.5天)
   - 工作内容: [详细描述]
   - 输入: Step 001.2 的输出
   - 输出: [最终交付物]
   - 验证: [最终验证标准]

### ⏳ Task 002: [第二个任务名称] (预估: X天) - **[待Step拆解]**
**目标**: [高层次目标描述]
**依赖**: Task 001
**备注**: Task 001 完成后将详细拆解Steps

### ⏳ Task 003: [第三个任务名称] (预估: X天) - **[待Step拆解]**
**目标**: [高层次目标描述] 
**依赖**: Task 002

## Requirement 2: [下一个需求] - **[待Task拆解]**
**概述**: [简要描述，具体Tasks待Requirement 1完成后规划]
**预估**: X周

### 即时行动计划
```
✅ 立即可执行: Task 001 (已详细拆解)
⏳ 下一步规划: Task 001 完成后拆解 Task 002
📋 Requirement级规划: Requirement 1 接近完成时详细规划 Requirement 2
```

## 注意事项

### 渐进式分解原则
- **避免过度规划**: 不要一次性详细拆解所有Task，保持灵活性
- **聚焦当前**: 只为即将执行的Task创建详细的Steps
- **及时调整**: 根据执行过程中的发现，调整后续Task的规划
- **保持简洁**: 未来的Task保持高层次描述，避免信息过载

### 一般性注意事项
- 始终遵循 `CLAUDE.md` 中的代码规范和项目约定
- 保持与用户的双向沟通，及时澄清疑问
- 任务分解要考虑技术债务和重构需求
- 预留缓冲时间处理意外情况和技术挑战